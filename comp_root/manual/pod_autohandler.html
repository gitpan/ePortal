<HTML>
<HEAD>
<TITLE>autohandler.mc - Base Mason component</TITLE>
<LINK REV="made" HREF="mailto:rusakov_sa@users.sourceforge.net">
</HEAD>

<BODY>

<A NAME="__index__"></A>
<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#name">NAME</A></LI>
	<LI><A HREF="#synopsis">SYNOPSIS</A></LI>
	<LI><A HREF="#attributes">ATTRIBUTES</A></LI>
	<UL>

		<LI><A HREF="#title">Title</A></LI>
		<LI><A HREF="#popup">Popup</A></LI>
		<LI><A HREF="#directory%20browsing">Directory browsing</A></LI>
		<UL>

			<LI><A HREF="#dir_enabled">dir_enabled</A></LI>
			<LI><A HREF="#dir_nobackurl">dir_nobackurl</A></LI>
			<LI><A HREF="#dir_sortcode">dir_sortcode</A></LI>
			<LI><A HREF="#dir_description">dir_description</A></LI>
			<LI><A HREF="#dir_columns">dir_columns</A></LI>
			<LI><A HREF="#dir_include%2Cdir_exclude">dir_include,dir_exclude</A></LI>
			<LI><A HREF="#dir_title">dir_title</A></LI>
		</UL>

		<LI><A HREF="#access%20control">Access control</A></LI>
		<UL>

			<LI><A HREF="#require_registered%20%3D%3E%20boolean">require_registered =&gt; boolean</A></LI>
			<LI><A HREF="#require_user%20%3D%3E%20%5B%20%5D">require_user =&gt; [ ]</A></LI>
			<LI><A HREF="#require_group%20%3D%3E%20%5B%20%5D">require_group =&gt; [ ]</A></LI>
			<LI><A HREF="#require_admin%20%3D%3E%20boolean">require_admin =&gt; boolean</A></LI>
			<LI><A HREF="#require_sysacl%20%3D%3E%20%5Baclname%2C%20righ">require_sysacl =&gt; [aclname, right]</A></LI>
		</UL>

	</UL>

	<LI><A HREF="#methods%20to%20overload">METHODS TO OVERLOAD</A></LI>
	<UL>

		<LI><A HREF="#htmlhead">HTMLhead</A></LI>
		<LI><A HREF="#onstartrequest">onStartRequest</A></LI>
		<LI><A HREF="#title">Title</A></LI>
		<LI><A HREF="#footer">Footer</A></LI>
		<LI><A HREF="#menuitems">MenuItems</A></LI>
	</UL>

	<LI><A HREF="#common%20url%20arguments">COMMON URL ARGUMENTS</A></LI>
	<LI><A HREF="#author">AUTHOR</A></LI>
</UL>
<!-- INDEX END -->

<HR>
<P>
<H1><A NAME="name">NAME</A></H1>
<P>autohandler.mc - Base Mason component</P>
<P>
<HR>
<H1><A NAME="synopsis">SYNOPSIS</A></H1>
<P>autohandler.mc is base Mason component for entire ePortal site.</P>
<P>
<HR>
<H1><A NAME="attributes">ATTRIBUTES</A></H1>
<P>Attributes are defined via &lt;attr&gt; mason tag:</P>
<PRE>
 &lt;%attr&gt;
 Attribute =&gt; value
 &lt;/%attr&gt;</PRE>
<P>
<H2><A NAME="title">Title</A></H2>
<P>This is title for the page. This title is used for &lt;TITLE&gt; HTML tag
and displayed at top of every ePortal's page.</P>
<P>This attribute is used for static Title. For dynamic Title see <CODE>Title</CODE> method</P>
<P>
<H2><A NAME="popup">Popup</A></H2>
<P>May be 1 or 0. Default is 0.</P>
<P>Used for popup windows. No windows caption, no APP bar, no menus.</P>
<P>
<H2><A NAME="directory%20browsing">Directory browsing</A></H2>
<P>There are some attributes to control directory browsing process. Browsing
is go when no index.htm file in directory.</P>
<P>
<H3><A NAME="dir_enabled">dir_enabled</A></H3>
<P>Enable or disable directory browsing. Default is 1. Is browsing is disabled
then redirect to /errors/not_found.htm is done.</P>
<P>
<H3><A NAME="dir_nobackurl">dir_nobackurl</A></H3>
<P>Show or not <CODE>..</CODE> at top of list of files.</P>
<P>
<H3><A NAME="dir_sortcode">dir_sortcode</A></H3>
<P>Should be sub ref. Two arguments ($a,$b) are passed to sub which both are
absolute filenames.</P>
<P>
<H3><A NAME="dir_description">dir_description</A></H3>
<P>How to discover a description of a file? May be HASH with filenames or sub
ref. Two arguments <CODE>(absolute_filename,filename)</CODE> are passed to sub.</P>
<P>The default is <CODE>\&amp;ePortal::Utils::filter_auto_title</CODE></P>
<P>
<H3><A NAME="dir_columns">dir_columns</A></H3>
<P>How many columns and which to show? This is array ref. Possible values are:
/icon name size modified description/</P>
<P>
<H3><A NAME="dir_include%2Cdir_exclude">dir_include,dir_exclude</A></H3>
<P>Array ref with regexs. First all dir_include regexs work then dir_exclude.
Default is to include all files.</P>
<P>
<H3><A NAME="dir_title">dir_title</A></H3>
<P>How to title the directory listing? Default is directory name.</P>
<P>
<H2><A NAME="access%20control">Access control</A></H2>
<P>You always may restrict access to some pages with a help of .htaccess. Use
<CODE>require</CODE> directives to to this.</P>
<P>Here is another way to do this. You may use the following attributes in
pages or directory autohandlers to restrict access to some parts of your
site.</P>
<P>Attributes are processed in given order. If any of them are true then
access is allowed else redirect is made to /errors/require_xxx.htm page.</P>
<P>
<H3><A NAME="require_registered%20%3D%3E%20boolean">require_registered =&gt; boolean</A></H3>
<P>Requre user to be registered. Deny access for anonymous users.</P>
<P>
<H3><A NAME="require_user%20%3D%3E%20%5B%20%5D">require_user =&gt; [ ]</A></H3>
<P>Require user to be registered and be listed. Argument if array ref to list
of valid user names.</P>
<P>
<H3><A NAME="require_group%20%3D%3E%20%5B%20%5D">require_group =&gt; [ ]</A></H3>
<P>Require user to be registered and be member of a group. Argument if array ref to list
of valid group names.</P>
<P>
<H3><A NAME="require_admin%20%3D%3E%20boolean">require_admin =&gt; boolean</A></H3>
<P>Require user to be registered and be an admin.</P>
<P>
<H3><A NAME="require_sysacl%20%3D%3E%20%5Baclname%2C%20righ">require_sysacl =&gt; [aclname, right]</A></H3>
<P>Require call to $ePortal-&gt;<CODE>sysacl_check(aclname,right)</CODE> to be true.</P>
<P>
<HR>
<H1><A NAME="methods%20to%20overload">METHODS TO OVERLOAD</A></H1>
<P>You may overload some autohandler's method to add more functionality to a
page.</P>
<PRE>
 &lt;%method method_name&gt;
 .. your code goes here
 return &quot;something&quot;;
 &lt;/%method&gt;</PRE>
<P>Overloaded parent can be called as</P>
<PRE>
 &lt;&amp; PARENT:method_name, %ARGS &amp;&gt;</PRE>
<P>
<H2><A NAME="htmlhead">HTMLhead</A></H2>
<P>Add any HTML text to put in &lt;HEAD&gt; section of HTML page.</P>
<P>
<H2><A NAME="onstartrequest">onStartRequest</A></H2>
<P>This method is called just after request processing preparation (check
user, etc.) but before any content is sent to client. This method is useful
for client events processing and handling redirects.</P>
<P>Any string returned is passed to redirect.mc to do external redirect.</P>
<P>
<H2><A NAME="title">Title</A></H2>
<P>This is the same functionality as <CODE>Title</CODE> attribute. This method is used
to make the Title be dynamic not static.</P>
<P>
<H2><A NAME="footer">Footer</A></H2>
<P>This is very last part of screen. Useful to show copyright messages</P>
<P>
<H2><A NAME="menuitems">MenuItems</A></H2>
<P>This method is used to show a menu on the left side of the screen. It
returns an array or pairs.</P>
<PRE>
 &lt;% method MenuItems&gt;
 % return [
   ['menu1' =&gt; '<A HREF="http://">http://</A>...'],
   ['---' =&gt; '---'],
   ['html' =&gt; '&lt;b&gt;this is HTML&lt;/b&gt;']
  ];
 &lt;/%method&gt;</PRE>
<P>Every pair may be any of the following</P>
<UL>
<LI><STRONG><A NAME="item_%255B%2527title%2527%252C%2527URL%2527%25">['title','URL']</A></STRONG><BR>

Used to make usual menu item
<P></P>
<LI><STRONG><A NAME="item_%255B%2527%252D%252D%252D%2527%252C%2527%252D">['---','---']</A></STRONG><BR>

Make a horizontal separator 1 pixel height
<P></P>
<LI><STRONG><A NAME="item_%255B%2527require%252Duser%2527%252C%25">['require-user','username']</A></STRONG><BR>

Require <CODE>username</CODE> to be registered to see next items.
<P></P>
<LI><STRONG><A NAME="item_%255B%2527require%252Dgroup%2527%252C">['require-group','groupname']</A></STRONG><BR>

Require the user to be member to the <CODE>groupname</CODE> to see next items.
<P></P>
<LI><STRONG><A NAME="item_%255B%2527require%252Dnone%2527%252C%25">['require-none','']</A></STRONG><BR>

Turns off any restriction on user or group to see next items.
<P></P>
<LI><STRONG><A NAME="item_%255B%2527html%2527%252C%2527any_HTML">['html','any HTML text']</A></STRONG><BR>

This pair is used to produce any HTML text at this point.
<P></P>
<LI><STRONG><A NAME="item_%255B%2527img%2527%252C%2527http%253A%252">['img','http://www/images/file.gif']</A></STRONG><BR>

Just insert an image at this point
<P></P>
<LI><STRONG><A NAME="item_%255B%2527%2527%252C5%255D">['',5]</A></STRONG><BR>

Insert blank row 5 pixels width.
<P></P></UL>
<P>
<HR>
<H1><A NAME="common%20url%20arguments">COMMON URL ARGUMENTS</A></H1>
<P>Some arguments names are reserved for internal purposes. Here are:</P>
<UL>
<LI><STRONG><A NAME="item_objid">objid</A></STRONG><BR>

Object identifier. The ID of the current object to work with it.
<P></P>
<LI><STRONG><A NAME="item_objtype">objtype</A></STRONG><BR>

Type of the object. It means <CODE>ref($object)</CODE> in Perl.
<P></P>
<LI><STRONG><A NAME="item_cal_xxx">cal_xxx</A></STRONG><BR>

Reserved for <CODE>calendar</CODE> component
<P></P>
<LI><STRONG><A NAME="item_dlg_xxx%252Cdlgb_xxx">dlg_xxx,dlgb_xxx</A></STRONG><BR>

Reserved for Dialog controls and buttons.
<P></P>
<LI><STRONG><A NAME="item_list_xxx">list_xxx</A></STRONG><BR>

Reserved for <CODE>list</CODE> component.
<P></P></UL>
<P>
<HR>
<H1><A NAME="author">AUTHOR</A></H1>
<P>Sergey Rusakov, &lt;<A HREF="mailto:rusakov_sa@users.sourceforge.net">rusakov_sa@users.sourceforge.net</A>&gt;</P>

</BODY>

</HTML>

%#============================================================================
%# ePortal - WEB Based daily organizer
%# Author - S.Rusakov <rusakov_sa@users.sourceforge.net>
%#
%# Copyright (c) 2001 Sergey Rusakov.  All rights reserved.
%# This program is free software; you can redistribute it
%# and/or modify it under the same terms as Perl itself.
%#
%# $Revision: 3.1 $
%# $Date: 2003/04/24 05:36:52 $
%# $Header: /home/cvsroot/ePortal/comp_root/catalog/index.htm,v 3.1 2003/04/24 05:36:52 ras Exp $
%#
%#----------------------------------------------------------------------------
%# Parameters:
%#    group=<id> display this group
%#
%#----------------------------------------------------------------------------

<& /message.mc &>
<table width="100%" border=0>
<tr><td>
<& /catalog/groups.htm, group => $ARGS{group} &>
<& /catalog/links.htm, group => $ARGS{group} &>
</td><td width="10%">
  <& SELF:search_dialog, %ARGS &>
  <% empty_table(height => 5) %>
  <& /catalog/mostpopular.htm &>
</td></tr></table>




%#=== @metags search_dialog ====================================================
<%method search_dialog>
  <% $search_dialog->dialog_start(
                              title => pick_lang(
                                rus => 'Поиск в каталоге',
                                eng => 'Search in Catalog'),
                              method => 'GET',
                              action => "/catalog/search.htm",
                              width => '100%') %>
  <% $search_dialog->field("text", label=>undef,  ) %>
  <% $search_dialog->field("group", hidden => 1, value => $ARGS{group}) %>
  <% $search_dialog->buttons(
      ok_label => pick_lang(rus => "Искать!", eng => "Search!"),
      cancel_button => 0) %>

  <% $search_dialog->dialog_end %>
</%perl></%method>




%#=== @metags onStartRequest ====================================================
<%method onStartRequest><%perl>
  #
  # Add Search dialog
  #
  my $ss = new ePortal::ThePersistent::Session;
  $ss->add_attribute( text => {
          label => '',#{rus => 'Искать', eng => 'Search'},
          dtype => 'Varchar',
          size => 30, });

  $search_dialog = new ePortal::HTML::Dialog();

  my $location = $search_dialog->handle_request(obj => $ss, objid => '/catalog/index.htm');
  return $location if $location;


  #
  # If group parameter passed as nickname then do redirect to Numeric ID
  #
  if ($ARGS{group} ne '' and $ARGS{group} !~ /^\d+$/) {
    my $group = new ePortal::Catalog;
    if ($group->restore($ARGS{group})) {
      return href("index.htm", group => $group->id);
    }
  }
</%perl></%method>


%#=== @METAGS once =========================================================
<%once>
my $search_dialog = undef;
</%once>
